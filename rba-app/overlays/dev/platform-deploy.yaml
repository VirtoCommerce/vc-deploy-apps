apiVersion: apps/v1
kind: Deployment
metadata:
  name: platform
spec:
  template:
    spec:
      initContainers:
        - name: init-platform
          command: 
            - "python3"
            - "install-modules.py"
            - "$(VC_PLATFORM_MODULES_CONFIG)"
            - "/opt/virtocommerce/platform/Modules/"
          env:
            - name: VC_PLATFORM_MODULES_CONFIG
              value: https://raw.githubusercontent.com/VirtoCommerce/vc-deploy-apps/master/rba-app/overlays/dev/modules.json?BA2F41C0D1FD486CB031B79A2573693E35BA60C8F2686C5863B9DC9D340E4A9C
            - name: THEME_REPOSITORY
              value: https://github.com/VirtoCommerce/vc-theme-default.git
            - name: THEME_LOCATION
              value: /opt/virtocommerce/platform/wwwroot/cms-content/Themes/Electronics/default  
          volumeMounts:
            - mountPath: /opt/virtocommerce/platform/Modules
              name: modules-data
            - mountPath: /opt/virtocommerce/platform/wwwroot/cms-content
              name: cms-content-data
      containers:
        - name: vc-platform-web   
          env:
            - name: VirtoCommerce__SampleDataUrl
              value: https://vcbacpac.blob.core.windows.net/dac-packages/rba_exported_data.zip

